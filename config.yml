# Rooney Capital live worker configuration
# ---------------------------------------------------------------------------
# Copy to `config.yml` (or another filename referenced by $PINE_RUNTIME_CONFIG)
# and customise values for your environment. Secrets can be interpolated from
# environment variables using ${VAR_NAME} syntax.

# ---------------------------------------------------------------------------
# Core paths and credentials
# ---------------------------------------------------------------------------
contract_map: Data/Databento_contract_map.yml

# ML models path:
# - For IBS strategies (use_factory_strategies: false): expects {SYMBOL}_rf_model.pkl
# - For Strategy Factory (use_factory_strategies: true): expects {SYMBOL}_ml_meta_labeling_final_model.pkl
models_path: models/factory

symbols:  # All symbols to load (for complete ML feature calculation)
  - 6A
  - 6B
  - 6C
  - 6E
  - 6J
  - 6M
  - 6N
  - 6S
  - CL
  - ES
  - GC
  - HG
  - NG
  - NQ
  - PL
  - RTY
  - SI
  - TLT
  - YM

databento_api_key: ${DATABENTO_API_KEY}
traderspost_webhook: ${TRADERSPOST_WEBHOOK_URL}
discord_webhook_url: ${DISCORD_WEBHOOK_URL}

killswitch: ${POLICY_KILLSWITCH}

# ---------------------------------------------------------------------------
# Portfolio management
# ---------------------------------------------------------------------------
# Optimal portfolio from exhaustive optimization (Dec 2024):
# Train Sharpe: 6.411, Test Sharpe: 3.840, Generalization: 59.9%
# Max Drawdown: $4,044 (train), $2,853 (test)
portfolio:
  max_positions: 5
  daily_stop_loss: 3000
  use_factory_strategies: true  # Use Strategy Factory adapter instead of IbsStrategy
  instruments:
    - symbol: 6B
      strategy: ATRBuyDip
      params:
        atr_period: 28
        atr_multiplier: 2.0
        smoothing_period: 5
        ema_period: 200
        use_ema_filter: true
    - symbol: CL
      strategy: ATRBuyDip
      params:
        atr_period: 28
        atr_multiplier: 2.0
        smoothing_period: 15
        ema_period: 200
        use_ema_filter: true
    - symbol: ES
      strategy: AvgHLRangeIBS
      params:
        length: 25
        range_multiplier: 3.0
        bars_below_threshold: 1
        ibs_buy_threshold: 0.1
    - symbol: GC
      strategy: ATRBuyDip
      params:
        atr_period: 28
        atr_multiplier: 2.0
        smoothing_period: 15
        ema_period: 200
        use_ema_filter: true
    - symbol: HG
      strategy: MovingAverageEnvelope
      params:
        mae_length: 200
        mae_envelope_pct: 3.0
    - symbol: NQ
      strategy: ATRBuyDip
      params:
        atr_period: 28
        atr_multiplier: 2.0
        smoothing_period: 5
        ema_period: 200
        use_ema_filter: true
    - symbol: RTY
      strategy: ATRBuyDip
      params:
        atr_period: 28
        atr_multiplier: 2.0
        smoothing_period: 5
        ema_period: 150
        use_ema_filter: true

# ---------------------------------------------------------------------------
# Cash management and runtime behaviour
# ---------------------------------------------------------------------------
starting_cash: 250000
# Historical data loading (uses Historical API)
load_historical_warmup: true
historical_lookback_days: 252
historical_warmup_compression: 1h  # Use 1h/1d to aggregate warmup bars when strategies allow.

# Live streaming backfill (uses Live API - max 4 days)
backfill: true
backfill_days: 4
# backfill_days: 4
resample_session_start: "23:00"
queue_maxsize: 4096
heartbeat_interval: 30
heartbeat_file: /var/run/pine/worker_heartbeat.json
heartbeat_write_interval: 30
poll_interval: 1.0

# ---------------------------------------------------------------------------
# Preflight validation controls
# ---------------------------------------------------------------------------
preflight:
  enabled: true
  skip_ml_validation: false
  skip_connection_checks: true
  fail_fast: true

# ---------------------------------------------------------------------------
# Instrument-specific overrides
# ---------------------------------------------------------------------------
contracts:
  6A:
    size: 1
  6B:
    size: 1
  6C:
    size: 1
  6E:
    size: 1
  6J:
    size: 1
  6M:
    size: 1
  6N:
    size: 1
  6S:
    size: 1
  CL:
    size: 1
  ES:
    size: 1
  GC:
    size: 1
  HG:
    size: 1
  NG:
    size: 1
  NQ:
    size: 1
  PL:
    size: 1
  RTY:
    size: 1
  SI:
    size: 1
  TLT:
    size: 1
  YM:
    size: 1
